---
type: template
name: product
defaults:
  arches: [ x86_64 ]

content: |
  ---
  type: group
  name: {{ name }}-packagers
  permissions:
    - "{{ name }}-pkglist"
    - "{{ name }}-taggers"

  ---
  type: permission
  name: {{ name }}-pkglist
  description: "Can update package list for {{ name }}"

  ---
  type: permission
  name: {{ name }}-taggers
  description: "Can tag builds for {{ name }}"

  ---
  type: template
  name: {{ name }}-version
  defaults:
    name: {{ name }}
    version: "1.0"
    platforms: [ "fedora-42" ]
    arches: [ {{ ", ".join(arches) }} ]
  content: |
    {% raw %}
    {% set g = namespace() %}
    {% for platform in platforms %}
    {% set g.basetag = "-".join((name, version, platform)) %}
    ---
    type: tag
    name: {{ g.basetag }}-build
    locked: True
    permission: admin
    arches: [ {{ ", ".join(arches) }} ]

    inheritance:
      - name: {{ g.basetag }}-overrides
        priority: 0

      - name: {{ g.basetag }}-candidate
        priority: 5

      - name: {{ g.basetag }}-released
        priority: 10

      - name: {{ platform }}-build-base
        priority: 100

    ---
    type: tag
    name: {{ g.basetag }}-overrides
    permission: {{ name }}-taggers
    inheritance:
      - {{ g.basetag }}

    ---
    type: tag
    name: {{ g.basetag }}-candidate
    permission: {{ name }}-taggers
    inheritance:
      - {{ g.basetag }}

    ---
    type: tag
    name: {{ g.basetag }}-released
    permission: trusted
    inheritance:
      - {{ g.basetag }}

    ---
    type: tag
    name: {{ g.basetag }}
    locked: True
    permission: admin

    ---
    type: target
    name: {{ g.basetag }}-candidate
    build-tag: {{ g.basetag }}-build
    dest-tag: {{ g.basetag }}-candidate

    {% endfor %}
    {% endraw %}

# The end.
