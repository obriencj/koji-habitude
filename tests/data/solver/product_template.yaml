# Template for creating product-based dependency structures
# Similar to demo/product.yml but focused on solver testing

---
type: template
name: product
defaults:
  arches: [x86_64]

content: |
  ---
  type: group
  name: {{ name }}-packagers
  permissions:
    - "{{ name }}-pkglist"
    - "{{ name }}-taggers"

  ---
  type: template
  name: {{ name }}-version
  defaults:
    name: {{ name }}
    version: "1.0"
    arches: [{{ ", ".join(arches) }}]
  content: |
    {% raw %}
    {% set g = namespace() %}
    {% set g.basetag = "-".join((name, version)) %}

    ---
    type: tag
    name: {{ g.basetag }}-build
    locked: true
    arches: [{{ ", ".join(arches) }}]
    inheritance:
      - name: {{ g.basetag }}-candidate
        priority: 5
      - name: {{ g.basetag }}-released
        priority: 10

    ---
    type: tag
    name: {{ g.basetag }}-candidate
    inheritance:
      - name: {{ g.basetag }}

    ---
    type: tag
    name: {{ g.basetag }}-released
    inheritance:
      - name: {{ g.basetag }}

    ---
    type: tag
    name: {{ g.basetag }}
    locked: true

    ---
    type: target
    name: {{ g.basetag }}-candidate
    build-tag: {{ g.basetag }}-build
    dest-tag: {{ g.basetag }}-candidate

    ---
    type: target
    name: {{ g.basetag }}-release
    build-tag: {{ g.basetag }}-candidate
    dest-tag: {{ g.basetag }}-released

    {% endraw %}

# The end.
